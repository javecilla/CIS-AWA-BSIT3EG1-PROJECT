---
alwaysApply: true
---

# WARP.md

This file provides guidance to WARP (warp.dev) when working with code in this repository.

## Project Overview

Clinic Information System - Patient Management Module. A React-based web application for managing patient records and appointments at an animal bite center. Built with React + Vite, Firebase (Auth, Realtime Database, Storage, Hosting), Bootstrap, EmailJS, and reCAPTCHA v2.

## Common Development Commands

### Development

```bash
npm run dev              # Start Vite dev server (default: http://localhost:5173)
npm run build            # Build for production (outputs to dist/)
npm run preview          # Preview production build locally
npm run lint             # Run ESLint on codebase
```

### Firebase Setup & Deployment

```bash
# Initial Firebase Setup (one-time)
npm install -g firebase-tools  # Install Firebase CLI globally
firebase login                 # Login to Firebase account
firebase init                  # Initialize Firebase in project root

# Deployment
npm run build                  # Build for production first
firebase deploy --only hosting # Deploy to Firebase Hosting
```

### Testing

There are no automated tests in this project. QA is performed manually based on Figma designs and test cases.

## Architecture Overview

### Authentication & Authorization

- **Two-tier role system**: `patient` and `staff` roles defined in `src/constants/user-roles.js`
- **Authentication flow**: Firebase Authentication with email verification requirement
- **User context**: `UserContext` (`src/contexts/UserContext.jsx`) manages auth state and fetches user data from Firebase Realtime Database
- **Protected routes**: `ProtectedRoute` component in `App.jsx` enforces role-based access control and redirects based on user role
- **Role-based routing**: Routes use dynamic `:role` parameter (e.g., `/patient/dashboard`, `/staff/dashboard`)

### Data Architecture

- **Firebase Realtime Database**: All user, patient, and appointment data stored in Firebase RTDB
- **Data structure**: Users stored under `users/{uid}` with role property (`patient` or `staff`)
- **Services layer**:
  - `authService.js`: Firebase Authentication operations
  - `patientService.js`: Patient-related CRUD operations
  - `staffService.js`: Staff-related operations
- **Firebase config**: Centralized in `src/libs/firebase.js`, uses environment variables from `.env`

### Application Structure

- **Dual portal system**:
  - **Patient portal**: Registration, login, dashboard, profile view, appointment booking (new bite incident or follow-up)
  - **Staff portal**: Dashboard with daily appointments, patient search, walk-in patient registration
- **Routing**: React Router with nested routes under `/:role/` prefix
- **State management**: React Context API (UserContext) for global auth state
- **File organization**: Feature-based structure (see docs/PROJECT_STRUCTURE.md)

### Third-Party Integrations

#### EmailJS

- Used for sending email notifications
- Requires account setup at [emailjs.com](https://www.emailjs.com/)
- Configuration stored in `.env`:
  - `VITE_EMAILJS_SERVICE_ID`: Email service ID (Gmail, Yahoo, etc.)
  - `VITE_EMAILJS_TEST_TEMPLATE_ID`: Template ID for emails
  - `VITE_EMAILJS_PUBLIC_API_KEY`: Public API key
  - `VITE_EMAILJS_PRIVATE_API_KEY`: Private API key (optional, for added security)
  - `VITE_EMAILJS_SENDER_MAIL`: Sender email address
- Integration pattern:
  ```jsx
  import emailjs from '@emailjs/browser'
  // Use with reCAPTCHA validation before sending
  await emailjs.send(SERVICE_ID, TEMPLATE_ID, templateParams, PUBLIC_KEY)
  ```

#### reCAPTCHA v2

- "I'm not a robot" checkbox for form security
- Requires setup at [Google reCAPTCHA Admin Console](https://www.google.com/recaptcha/admin/create)
- Configuration:
  - `VITE_RECAPTCHA_FRONTEND_KEY`: Site key for client-side
  - `VITE_RECAPTCHA_BACKEND_KEY`: Secret key for server-side verification
  - Domains to add: `localhost` (testing) and production domain
- Must add script to `index.html`:
  ```html
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  ```
- Integration pattern:
  ```jsx
  import ReCAPTCHA from 'react-google-recaptcha'
  const [recaptchaToken, setRecaptchaToken] = useState(null)
  const recaptchaRef = useRef(null)
  // Always validate token before form submission
  if (!recaptchaToken) {
    /* show error */
  }
  ```

#### Firebase Services

- **Authentication**: Email/Password provider with email verification required
- **Realtime Database**: NoSQL database for users, patients, and appointments
  - Start in test mode for development
  - Location: asia-southeast1 (recommended)
  - Security rules must be configured before production
- **Storage**: For user profile pictures
- **Hosting**: For production deployment (site: `cis-awa-bsit3eg1-project`)
- All Firebase services configured in `src/libs/firebase.js`

#### UI Libraries

- **Bootstrap**: UI framework for styling (no custom design system)
- **Font Awesome**: Icon library

## Project Structure

```
Animal Bite Center (CIS) /
├── src/
│   ├── components/     # Reusable UI components organized by feature
│   ├── pages/          # Page components separated by user type (Patient/Staff)
│   ├── assets/         # Processed assets that require bundler handling
│   ├── utils/          # Utility functions and helpers
│   ├── services/       # API integration and business logic (authService, patientService, staffService)
│   ├── libs/           # Third-party library configurations (firebase.js)
│   ├── constants/      # Static data or variables (user-roles.js)
│   ├── contexts/       # React context providers for state management (UserContext)
│   ├── hooks/          # Custom reusable hooks (useRoleNavigation)
│   ├── App.jsx         # Root component with routing and ProtectedRoute
│   ├── index.css       # Base stylesheets
│   └── main.jsx        # Entry point
├── public/
│   └── assets/
│       ├── images/     # Static images that don't require processing
│       └── meta/       # SEO-related files (favicons, manifest, etc.)
├── docs/               # Project documentation (STANDARDS.md, PROJECT_STRUCTURE.md, etc.)
├── .env                # Environment variables (DO NOT COMMIT)
├── .env.example        # Environment variables template
├── vite.config.js      # Build and development setup (includes @ alias for src/)
├── eslint.config.js    # Code style and quality rules
├── firebase.json       # Firebase hosting configuration
└── package.json        # Dependencies and scripts
```

## Coding Standards

### File Naming & Structure

| Type         | Convention                                       | Example                                            |
| ------------ | ------------------------------------------------ | -------------------------------------------------- |
| Components   | PascalCase folder + `index.js` export            | `components/UserCard/UserCard.jsx` with `index.js` |
| Pages        | Grouped under `pages/Patient/` or `pages/Staff/` | `pages/Patient/Dashboard/Dashboard.jsx`            |
| Utils/Config | kebab-case                                       | `utils/date-formatter.js`                          |
| CSS          | kebab-case or match component                    | `Navbar.css` or `patient-dashboard.css`            |
| Assets       | kebab-case or snake_case                         | `logo-clinic.png`                                  |

### React & JavaScript Conventions

**File Extensions & Structure**

- All React components MUST use `.jsx` extension (e.g., `Login.jsx`, `Header.jsx`)
- Every major component lives in its own dedicated folder with an `index.js` export
  - Example: `components/UserCard/UserCard.jsx` with `components/UserCard/index.js` containing `export { default } from './UserCard.jsx'`
- Pages MUST be grouped under `pages/Patient/` or `pages/Staff/`

**Props & Function Signatures**

- Always destructure props in function signature: `function UserCard({ userData, isLoading }) { ... }`
- All optional props, especially functions, must have explicit default values: `function Button({ onClick = () => {} }) { ... }`

**React Best Practices**

- **Key prop**: Mandatory for all `.map()` elements. Use stable IDs (Firebase keys): `<li key={item.id}>{item.name}</li>`
- **Effect dependencies**: Always specify all external variables in `useEffect` dependency array: `useEffect(() => { loadData(userId); }, [userId]);`
- **Avoid inline logic**: Move complex conditional rendering, filtering, or mapping out of `return()` statement:
  - ❌ Bad: `{data.map(item => <Item key={item.id} data={item} />)}`
  - ✅ Good: `const renderedItems = data.map(...); return <div>{renderedItems}</div>`

**Code Style**

- **Semicolons**: Always use semicolons at end of statements (even though ESLint has it turned off)
- **Comments**: Use clear, concise English for complex logic, workarounds, or state manipulation
  - Example: `// WORKAROUND: Force a reload because state updates too slowly.`

### Variable Naming

| Type        | Convention                         | Example                    |
| ----------- | ---------------------------------- | -------------------------- |
| Variables   | camelCase                          | `patientData`, `firstName` |
| React state | camelCase with `[value, setValue]` | `const [user, setUser]`    |
| Booleans    | Prefix with `is`, `has`, `should`  | `isLoading`, `hasError`    |
| Constants   | SCREAMING_SNAKE_CASE               | `MAX_LOGIN_ATTEMPTS`       |

### Commit Messages

Use Conventional Commits format: `type(scope): description`

- Examples: `feat(auth): Add email verification`, `fix(deploy): Resolve build directory mismatch`

## Environment Setup

### Prerequisites

1. Node.js and npm installed
2. Firebase account with project created
3. EmailJS account
4. Google reCAPTCHA v2 keys

### Step-by-Step Setup

**1. Install Dependencies**

```bash
npm install
```

**2. Configure Environment Variables**
Copy `.env.example` to `.env` and fill in the following:

```env
# EmailJS Configuration
VITE_EMAILJS_SERVICE_ID=your_service_id
VITE_EMAILJS_TEST_TEMPLATE_ID=your_template_id
VITE_EMAILJS_PUBLIC_API_KEY=your_public_key
VITE_EMAILJS_PRIVATE_API_KEY=your_private_key
VITE_EMAILJS_SENDER_MAIL=your_sender_email

# reCAPTCHA Configuration
VITE_RECAPTCHA_FRONTEND_KEY=your_site_key
VITE_RECAPTCHA_BACKEND_KEY=your_secret_key

# Firebase Configuration (from Firebase Console)
VITE_FIREBASE_API_KEY=your_api_key
VITE_FIREBASE_AUTH_DOMAIN=your_project.firebaseapp.com
VITE_FIREBASE_PROJECT_ID=your_project_id
VITE_FIREBASE_STORAGE_BUCKET=your_project.appspot.com
VITE_FIREBASE_MESSAGING_SENDER_ID=your_sender_id
VITE_FIREBASE_APP_ID=your_app_id
VITE_FIREBASE_DATABASE_URL=https://your_project.firebaseio.com
```

**3. Firebase Setup**

- Enable Email/Password authentication in Firebase Console (Build → Authentication → Sign-in method)
- Create Realtime Database (Build → Realtime Database → Create Database)
  - Choose location: asia-southeast1
  - Start in test mode for development
- Enable Storage for profile pictures
- Configure security rules before production deployment

**4. Verify Setup**

```bash
npm run dev  # Should start without errors
```

⚠️ **IMPORTANT**: Ensure `.env` is in `.gitignore` (already configured). Never commit credentials.

## Important Notes

- **Email verification required**: Users must verify email before accessing the app
- **Path alias**: `@/` maps to `src/` directory (configured in `vite.config.js`)
- **Build output**: Production builds go to `dist/` directory
- **Database security**: Firebase security rules should be properly configured before production (currently may be in test mode)
- **No backend server**: This is a pure frontend app with Firebase as BaaS (Backend as a Service)
- **Sprint-based development**: Project follows a sprint development plan (see README.md)

## Development Workflow

### Team Structure

This is a team project with five members:

- **Back-End Developer (Jerome)**: Firebase services, data structure, backend logic, deployment
- **Front-End Developer (Mico)**: Public pages (Login, Registration), staff dashboard
- **Front-End Developer (Rensen)**: Patient pages (Dashboard, Appointment Forms), protected routes
- **UI/UX Designer (Francis)**: Figma designs, UI/UX, responsive design
- **Quality Assurance (Giga)**: Test plans, functional testing, bug tracking

### Git Workflow

- Use **Conventional Commits** format: `type(scope): description`
  - Examples: `feat(auth): Add email verification`, `fix(deploy): Resolve build directory mismatch`
- Branch naming: Use descriptive names (e.g., `jerome`, `feature/patient-dashboard`)
- Never commit `.env` file or sensitive credentials

### Before Committing

1. Run `npm run lint` to check for code style issues
2. Test your changes locally with `npm run dev`
3. If building for production, test with `npm run build` and `npm run preview`
4. Ensure all console errors are resolved

## Troubleshooting

### Common Issues

**Build fails or "Cannot find module" errors**

- Ensure all dependencies are installed: `npm install`
- Check that path alias `@/` is working (configured in `vite.config.js`)

**Firebase connection errors**

- Verify all `VITE_FIREBASE_*` variables are set in `.env`
- Check Firebase Console for correct project configuration
- Ensure Firebase services (Auth, Database, Storage) are enabled

**reCAPTCHA not showing**

- Verify reCAPTCHA script is in `index.html` head
- Check that `VITE_RECAPTCHA_FRONTEND_KEY` is set in `.env`
- Ensure domain (`localhost` for dev) is added in reCAPTCHA Admin Console

**User redirect issues**

- Check `UserContext` for correct role assignment (`patient` or `staff`)
- Verify `ProtectedRoute` logic in `App.jsx`
- Ensure user email is verified (required for app access)

**EmailJS not sending**

- Verify all `VITE_EMAILJS_*` variables are set
- Check reCAPTCHA validation before sending email
- Test email service in EmailJS dashboard

## Key Files to Reference

### Documentation

- `README.md`: Project overview, team info, sprint plan, resources
- `docs/STANDARDS.md`: Complete coding standards (source of truth for team)
- `docs/PROJECT_STRUCTURE.md`: Detailed directory explanations
- `docs/FIREBASE.MD`: Firebase setup and configuration steps
- `docs/EMAILJS.md`: EmailJS integration guide with code examples
- `docs/RECAPTCHA.md`: reCAPTCHA v2 setup guide with code examples

### Core Application Files

- `src/App.jsx`: Main routing, ProtectedRoute component, role-based access control
- `src/main.jsx`: Application entry point with UserProvider
- `src/contexts/UserContext.jsx`: Auth state management, user data fetching
- `src/libs/firebase.js`: Firebase configuration and service initialization
- `src/constants/user-roles.js`: Role constants (`PATIENT`, `STAFF`)

### Service Layer

- `src/services/authService.js`: Firebase Authentication operations
- `src/services/patientService.js`: Patient CRUD operations
- `src/services/staffService.js`: Staff operations

### Configuration

- `vite.config.js`: Build config, path alias (`@/` → `src/`), asset handling
- `eslint.config.js`: Linting rules for code quality
- `firebase.json`: Firebase hosting configuration
